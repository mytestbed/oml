liboml2(1)
==========

NAME
----
liboml2 - OML2 client library

SYNOPSIS
--------
[verse]
*<oml2-enabled-app>* [APP-OPTIONS] [OML-OPTIONS]

DESCRIPTION
-----------

*liboml2* is the client library for OML2.  It provides an API for
application writers to collect measurements from their applications
via user-defined 'Measurement Points' (MPs).  It also provides a
flexible filtering and collection mechanism that allows application
users to customize how measurements are processed and stored by an
OML-enabled application.

This man page documents the command-line user configuration of
OML-enabled applications.  Application writers who want to learn how
to write an application using the *liboml2* API should consult
*liboml2*(3).  OML also supports an external configuration file,
documented in *liboml2.conf*(5).

When an OML application starts up, it passes the command line
arguments to *liboml2*, which scans them for options that it
understands, and uses those to configure itself.  *liboml2* then
removes its own options from the command line so that the application
proper does not get confused by them.  All OML options start with the
prefix '--oml-'.  The '--oml-help' option lists all the known OML command
line options.

The command line options recognized by *liboml2* allow for a basic
configuration of the measurement library.  They are adequate for
testing and debugging, but do not offer as much flexibility as the
external configuration file format supports.  You can pass a
configuration file to *liboml2* using the '--oml-config' option.  For
details, see *liboml2.conf*(5).

When no configuration file is given, *liboml2* provides a basic set of
filters for each measurement point, and sends measurements to just one
location (given by either the '--oml-server' or '--oml-file'
options).  For each measurement point, each element of the measurement
point's injected tuple is given its own filter.  The filter created
depends on the type of the element and the current sampling policy.

For instance, suppose a measurement point defined with a measurement tuple
as follows:

----------
MeasurementPoint (name = "link_properties")
("source"      : OML_UINT64_VALUE,
 "destination" : OML_UINT64_VALUE,
 "length"      : OML_INT32_VALUE,
 "snr"         : OML_DOUBLE_VALUE,
 "name"        : OML_STRING_VALUE)
----------

Then *liboml2* will create a separate filter for each of "source",
"destination", "length", "snr", and "name".  The filters for the first
four numeric elements will be an averaging filter (filter type
'avg'), and the last string element will be given a 'first' filter.
The 'first' filter keeps the first injected value in the current
sampling period and throws away all others, passing the first value on
to the measurement output stage.

The exception to this rule is that if '--oml-samples' was given, and
if the argument is 1, then numeric elements are filtered using the
'first' filter, not the averaging filter.

For more information on OML filters and how they are configured, see
the documentation for the configuration file format,
*liboml2.conf*(5). For more information on measurement points and how
they are defined, see *liboml*(3) and *omlc_add_mp*(3).

MEASUREMENT OUTPUT AND SCHEMAS
------------------------------

The measurement output of an OML program goes either to an SQL
database (if using the '--oml-server' option) or a file (if using the
'--oml-file' option).  Measurement points are created with a 'schema',
as above, a schema being an ordered list of (name, type) pairs.  Each
type of filter also has its own output schema.

OML filters also generate output with a declared schema.  For each
measurement point, *liboml2* generates a single output measurement
that is the union of the outputs of all filters attached to the MP.
The names of the fields (or columns) of the schema are derived from
the names of the original MP fields, and the output schemas of the
filters.  The schemas can be observed directly in the '--oml-file'
output (identical schemas are sent to the server when '--oml-server'
is used).  For instance, here is the output schema for a simple
example MP that measures a string ("label") and an integer ("seq_no"):

--------
schema: 1 generator_lin label:string seq_no:uint32
--------

The schema name is "generator_lin" -- a combination of the application
name ("generator") and the measurement point name ("lin").  (The
number '1' on this line is an index used in the output columns to
identify a line of measurement with the schema to which it conforms.)
This output was made using '--oml-samples 1' on the command line.
This creates a 'first' filter for both of the fields of the
measurement point.  The 'first' filter outputs a single value that has
the same type as the filter's input.

If we change the command line to use '--oml-samples 2', then an
averaging filter is used for the numeric "seq_no" field ("label" is
unchanged).  The schema therefore changes as well:

--------
schema: 2 generator_lin label:string seq_no_avg:double seq_no_min:double seq_no_max:double
--------

An 'avg' filter picks one field of the MP to filter (in this case
"seq_no") and then produces a 3-tuple as output (avg, min, max).
Therefore *liboml2* creates a schema for this filter output that looks
like:

--------
("seq_no_avg" : OML_DOUBLE_VALUE,
 "seq_no_min" : OML_DOUBLE_VALUE,
 "seq_no_max" : OML_DOUBLE_VALUE)
--------

This is the general pattern for filters:  their output schemas are
formed by appending the name of the source MP with the name of the
filter output field.  (The 'first' filter is an exception in that it
just takes the name of the input field and uses that as the output
field name.)

When the '--oml-server' option is used, a database table is created
for each measurement point using the combined OML output schema as
schema for the table.  For instance, the above example would translate
to an SQL CREATE statement like:

--------
CREATE TABLE generator_lin (label TEXT, seq_no_avg REAL, seq_no_min REAL, seq_no_max REAL);
--------

Note that even though an MP field may have an integral type, it may be
represented as a floating point type in the output because the filter
may output floating point values.  For instance, the average of a set
of integers is real valued because of the division in the averaging
operation.

OML OPTIONS
-----------
--oml-id id::
	Set the OML client's identity to 'id'.  This is used by the
	*oml2-server*(1) to distinguish measurements of the same type from
	different sources (for example, the same application running on a
	different machine).  If '--oml-id' is not given, an error is
	printed and measurement collection will not occur (although the
	application may still run).

--oml-exp-id exp-id::
	Set the OML client's experiment to 'exp-id'.  This is used by the
	*oml2-server*(1) to group measurements from different clients that
	logically belong to the same 'experiment'.  Multiple different
	applications running on multiple different machines can contribute
	measurements to the same experiment.  If '--oml-exp-id' is not given
	different machine).  If '--oml-exp-id' is not given, an error is
	written to the log file and measurement collection will not occur
	(although the application may still run).

--oml-file file::
Write measurements to 'file', in a human readable text format.
Only one of '--oml-file' and '--oml-server' can be active at a
time.

--oml-server uri::
Send measurements to the OML server specified by the 'uri'.  Only
one of '--oml-file' and '--oml-server' can be active at a time.
The format of the 'uri' is described in *URI FORMAT* below.  The 'uri'
can specify the address and port at which either an *oml2-server* or
an *oml2-proxy-server* is listening.

--oml-config file::
Read the contents of 'file' and use them to configure the *liboml2*
client.  See *liboml2.conf*(5) for details of the configuration file
format.  Generally, the configuration taken from 'file' overrides any
equivalents from the command line.  Command line options that cannot
be set using the configuration file are '--oml-log-file',
'--oml-log-level', '--oml-noop'.

--oml-samples count::
Make all measurement point filters produce an output after every 'count'
samples have been injected into them.  Only one of '--oml-samples' and
'--oml-interval' can be given on the same command line.  If neither
'--oml-samples' nor '--oml-interval' are given, then *liboml2* behaves
as if '--oml-samples' was given with an argument of 'count'=1.

--oml-interval seconds::
Make all measurement point filters produce an output periodically with
a time period of 'seconds'.  Only one of '--oml-interval' and
'--oml-samples' can be given on the same command line.

--oml-log-file file::
Write OML logging information to 'file'.  The amount of logging
information recorded is controlled by '--oml-log-level'.

--oml-log-level n::
Record logging information at a level of detail given by 'n', which
should be an integer from 0 to 4.  The defaul level of logging is 0,
which prints 'ERROR', 'WARNING', and 'INFO' messages.  Levels 1 to 4
add gradually larger amounts of debug logging ('DEBUG', 'DEBUG2',
'DEBUG3', 'DEBUG4').  It is possible to set 'n' to -1 for only 'ERROR'
and 'WARNING' logging, or -2 for only 'ERROR' logging.

--oml-noop::
If this option is given, no measurements are collected, and the
application does not attempt to connect to an OML server or write
measurements to file.

--oml-filters::
This option prints the available filters to the console and then
quits the application.

--oml-help::
Prints a summary of the available OML options.

URI FORMAT
----------
*liboml2* accepts a 'uri' argument for the '--oml-server' option
that is similar to an IETF URI (see e.g. RFC3986).  The OML URI
consists of an optional network protocol, a host identifier, and an
optional port number, or an optional 'file' protocol and a local
filesystem path.  The format of the network server version is:
---------------------------
		[tcp|udp]:[//]<host>:<port>
---------------------------
The format for the local file version is:
---------------------------
		file:[//]<local-path>
---------------------------

For instance, 'tcp:10.0.0.200:3003' or 'tcp://10.0.0.200:3003' will
send measurements to an *oml2-server* listening on port 3003 at IP
address 10.0.0.200, using TCP.  The '//' is recognized but optional.
Alternatively, 'file:/tmp/myfile.txt' writes to the /tmp/myfile.txt
file in the local filesystem.  Relative paths are also accepted.  The
'file' protocol also accepts an optional '//' between the colon ':'
and the local path.

ENVIRONMENT VARIABLES
---------------------
*liboml2* recognizes the following environment variables.  Note that
the equivalent command line options override any value set in an
environment variable.

OML_NAME::
The name to identify this client to the OML server, equivalent to the
'--oml-id' command line option.

OML_EXP_ID::
The name of the experiment to which this client's measurements
belong.  Used for grouping measurements into the same database on the
server.  Equivalent to the '--oml-exp-id' command line option.

OML_CONFIG::
The path to the configuration file to use to configure the client.
Equivalent to the '--oml-config' command line option.

OML_SERVER::
The URI of the server to which the measurements should be sent.  The
value of this environment variable should be a URI in the same format
specified above (*URI FORMAT*).  If the URI specifies the 'file:'
protocol, the measurements are written to the local text file
specified in the URI, rather than being sent to an OML server.
Equivalent to the '--oml-server' and '--oml-file' command line options.

BUGS
----

Reporting Bugs
~~~~~~~~~~~~~~

To report a bug, please email our support contacts listed here:
http://omf.mytestbed.net/wiki/oml/FAQ_and_Support

Known Bugs
~~~~~~~~~~

The selection of the 'first' filter when '--oml-samples 1' is used can
be confusing for numeric MP fields because it results in a different
schema in the measurement output compared to other possible
configurations available from the command line, which use the 'avg'
filter.  It is not clear whether this is a feature or a bug.

For other outstanding known bugs, please consult
http://omf.mytestbed.net/projects/oml/issues


SECURITY CONSIDERATIONS
-----------------------

'oml2-server' does not use any authentication, and should thus be
considered insecure.  It is intended to be deployed behind firewalls
on a dedicated testbed network.  It should not be run as a daemon on
an open network.  Future versions of OML may be re-designed to be
suitable for use in insecure environments.

SEE ALSO
--------
Manual Pages
~~~~~~~~~~~~
*oml2-server*(1), *oml2-proxy-server*(1), *liboml2*(3), *omlc_add_mp*(3)
*liboml2.conf*(5)

OML User Manual
~~~~~~~~~~~~~~~
http://omf.mytestbed.net/wiki/oml/Documentation
